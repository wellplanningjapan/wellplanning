<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ - Well Planning</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #8B7355;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success {
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
        .warning {
            border-left: 4px solid #ff9800;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #8B7355;
            color: white;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            overflow-x: auto;
            border-radius: 5px;
            font-size: 13px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Well Planning - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h1>
    <div id="result" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>

    <script>
        async function testPackages() {
            const resultDiv = document.getElementById('result');
            let html = '';

            try {
                // ãƒ†ã‚¹ãƒˆ1: APIæ¥ç¶šç¢ºèª
                html += '<div class="status warning">';
                html += '<h2>ğŸ“¡ ãƒ†ã‚¹ãƒˆ1: APIæ¥ç¶šç¢ºèª</h2>';
                html += '<p>APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«æ¥ç¶šã—ã¦ã„ã¾ã™...</p>';
                html += '</div>';

                const response = await fetch('tables/packages?limit=100');
                
                html += '<div class="status ' + (response.ok ? 'success' : 'error') + '">';
                html += '<h2>ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>';
                html += `<p><strong>Status Code:</strong> ${response.status}</p>`;
                html += `<p><strong>Status Text:</strong> ${response.statusText}</p>`;
                html += `<p><strong>OK:</strong> ${response.ok ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}</p>`;
                html += '</div>';

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // ãƒ†ã‚¹ãƒˆ2: ãƒ‡ãƒ¼ã‚¿å–å¾—
                const data = await response.json();
                const packages = data.data || [];

                html += '<div class="status ' + (packages.length > 0 ? 'success' : 'warning') + '">';
                html += '<h2>ğŸ“¦ ãƒ†ã‚¹ãƒˆ2: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿</h2>';
                html += `<p><strong>å–å¾—ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•°:</strong> ${packages.length}ä»¶</p>`;
                
                if (packages.length === 0) {
                    html += '<p style="color: orange;">âš ï¸ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>';
                } else {
                    html += '<p style="color: green;">âœ… ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«å–å¾—ã§ãã¾ã—ãŸï¼</p>';
                }
                html += '</div>';

                // ãƒ†ã‚¹ãƒˆ3: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è©³ç´°è¡¨ç¤º
                if (packages.length > 0) {
                    html += '<div class="status success">';
                    html += '<h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆ3: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è©³ç´°</h2>';
                    html += '<table>';
                    html += '<tr><th>ID</th><th>åå‰</th><th>ä¾¡æ ¼</th><th>èª¬æ˜</th><th>ç”»åƒURL</th><th>å•†å“æ•°</th></tr>';
                    
                    packages.forEach(pkg => {
                        html += '<tr>';
                        html += `<td><strong>${pkg.id || 'ãªã—'}</strong></td>`;
                        html += `<td>${pkg.name || 'ãªã—'}</td>`;
                        html += `<td>Â¥${pkg.price ? pkg.price.toLocaleString() : 0}</td>`;
                        html += `<td>${pkg.description ? pkg.description.substring(0, 50) + '...' : 'ãªã—'}</td>`;
                        html += `<td>${pkg.image_url || 'ãªã—'}</td>`;
                        html += `<td>${pkg.items ? pkg.items.length : 0}ç‚¹</td>`;
                        html += '</tr>';
                    });
                    
                    html += '</table>';
                    html += '</div>';
                }

                // ãƒ†ã‚¹ãƒˆ4: å®Œå…¨ãªJSONãƒ‡ãƒ¼ã‚¿
                html += '<div class="status success">';
                html += '<h2>ğŸ”¤ ãƒ†ã‚¹ãƒˆ4: å®Œå…¨ãªJSONãƒ¬ã‚¹ãƒãƒ³ã‚¹</h2>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                html += '</div>';

                // ãƒ†ã‚¹ãƒˆ5: æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                html += '<div class="status success">';
                html += '<h2>âœ… æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>';
                if (packages.length === 0) {
                    html += '<p><strong>å•é¡Œ:</strong> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
                    html += '<p><strong>è§£æ±ºç­–:</strong> Gensparkã®ãƒãƒ£ãƒƒãƒˆã«æˆ»ã£ã¦ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€ã¨ä¼ãˆã¦ãã ã•ã„ã€‚</p>';
                } else {
                    html += '<p><strong>ãƒ‡ãƒ¼ã‚¿ã¯æ­£å¸¸ã§ã™ï¼</strong></p>';
                    html += '<p>ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ (index.html) ã§ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p>';
                    html += '<ul>';
                    html += '<li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ (Ctrl+Shift+R)</li>';
                    html += '<li>F12ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦JavaScriptã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª</li>';
                    html += '<li>js/main.js ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª</li>';
                    html += '</ul>';
                }
                html += '<p><a href="index.html" style="color: #8B7355; font-weight: bold;">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a></p>';
                html += '</div>';

            } catch (error) {
                html += '<div class="status error">';
                html += '<h2>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>';
                html += `<p><strong>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong></p>`;
                html += `<pre>${error.message}\n\n${error.stack}</pre>`;
                html += '<p><strong>è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :</strong></p>';
                html += '<ul>';
                html += '<li>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ãªã„</li>';
                html += '<li>APIæ¥ç¶šã®å•é¡Œ</li>';
                html += '<li>CORSï¼ˆã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ï¼‰ã‚¨ãƒ©ãƒ¼</li>';
                html += '</ul>';
                html += '</div>';
            }

            resultDiv.innerHTML = html;
        }

        testPackages();
    </script>
</body>
</html>
